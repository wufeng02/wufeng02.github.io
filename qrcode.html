<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <meta name="robots" content="NOINDEX, NOFOLLOW"/>
        <title>Feng Wu (吴锋) | QRCode</title>
        <link href="//wufeng02.github.io/static/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <div class="container" style="text-align: center;">
            <h1 class="page-header">QRCode Generator</h1>

            <div class="row">
                <div class="col-xs-6" style="min-width: 256px;">
                    <a href="#" id="download" download="QRCode.png">
                        <div id="qrcode" style="width: 100%; height: 70vh"></div>
                    </a>
                </div>
                <div class="col-xs-6" style="min-width: 256px;">
                    <textarea id="text" autofocus class="form-control" 
                        placeholder="Type your contents ..." style="width: 100%; height: 70vh;"></textarea>
                    <div><span id="counter">0</span> characters</div>
                </div>
            </div>
        </div>
        <div class="footer" style="text-align: center;">
            <!--a href="https://zxing.appspot.com/generator/">ZXing Generator</a-->
        </div>

        <script src="//wufeng02.github.io/static/jquery/jquery.min.js" type="text/javascript"></script>
        <script src="//wufeng02.github.io/static/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="//wufeng02.github.io/static/qrcode/jquery.qrcode.min.js" type="text/javascript"></script>
        <script src="//wufeng02.github.io/static/qrcode/utf8.js" type="text/javascript"></script>
        <script type="text/javascript">
            (function($){
                var $q = $('#qrcode'), $t = $('#text'), 
                    $c = $('#counter'), $d = $('#download');

                var oldVal = null;
                function update(){
                    var currVal = $t.val();
                    if (currVal == oldVal) {
                        return;
                    }
                    oldVal = currVal;

                    $c.html(currVal.length);

                    var w = $q.width(), h = $q.height();
                    var size = (w < h ? w : h);
 
                    $q.empty().qrcode({
                        width: size,
                        height: size,
                        background: "#ffffff",
                        foreground: "#000000",
                        text: utf8.encode(currVal)
                    });
                }
                update();
                
                $t.on('change keyup paste input', update);

                $d.click(function(){
                    var canvas = $('#qrcode canvas').get()[0];
                    var imgData = canvas.toDataURL('image/png');
                    $d.attr('href', imgData);
                });

                $(window).resize(function() {
                    oldVal = null;
                    update();
                });
            })(jQuery);
        </script>
    </body>
</html>